<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Detalhes do Vestibular</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f4f4f4;
    }

    h1 {
      color: #1976d2;
    }

    form {
      background: white;
      padding: 20px;
      max-width: 600px;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
      color: #333;
    }

    input[type="text"],
    input[type="number"],
    input[type="date"],
    select,
    textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    button {
      margin-top: 20px;
      background-color: #1976d2;
      color: white;
      border: none;
      padding: 12px 20px;
      font-size: 16px;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background-color: #155a9c;
    }
  </style>
</head>
<body>

  <h1>Formulário de Inscrição</h1>

  <form id="form-inscricao">
    <!-- Campos serão carregados aqui -->
    <p>Carregando campos do formulário...</p>
  </form>

  <script>
    const API_KEY = "6855efa8bb5ccc0c9cf6d9ad";
    const BASE_URL = "https://vestibulares-302d.restdb.io/rest/Formcampos";

    // Função para pegar parâmetro id da URL
    function getIdVestibular() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('id');
    }

    // Monta campo do formulário dinamicamente
    function criarCampo(field) {
      const wrapper = document.createElement('div');

      const label = document.createElement('label');
      label.textContent = field.nome_campo;
      label.htmlFor = field.nome_campo.toLowerCase().replace(/\s+/g, '_');
      wrapper.appendChild(label);

      let input;

      switch(field.tipo.toLowerCase()) {
        case 'text':
          input = document.createElement('input');
          input.type = 'text';
          break;
        case 'number':
          input = document.createElement('input');
          input.type = 'number';
          break;
        case 'date':
          input = document.createElement('input');
          input.type = 'date';
          break;
        case 'textarea':
          input = document.createElement('textarea');
          break;
        case 'select':
          input = document.createElement('select');
          if (field.opcoes) {
            // As opções devem vir em string separadas por vírgula
            const opcoesArray = field.opcoes.split(',').map(o => o.trim());
            opcoesArray.forEach(op => {
              const option = document.createElement('option');
              option.value = op;
              option.textContent = op;
              input.appendChild(option);
            });
          }
          break;
        default:
          // Caso não reconheça, cria um input text padrão
          input = document.createElement('input');
          input.type = 'text';
      }

      input.id = label.htmlFor;
      input.name = label.htmlFor;
      wrapper.appendChild(input);

      return wrapper;
    }

    async function carregarCamposFormulario() {
      const idVestibular = getIdVestibular();
      if (!idVestibular) {
        document.getElementById('form-inscricao').innerHTML = '<p>ID do vestibular não informado na URL.</p>';
        return;
      }

      try {
        // Busca os campos do formulário filtrando por id_vestibular
        const filtro = encodeURIComponent(`{"id_vestibular":"${idVestibular}"}`);
        const resposta = await fetch(`${BASE_URL}?q=${filtro}`, {
          headers: {
            "x-apikey": API_KEY,
            "Content-Type": "application/json"
          }
        });

        const campos = await resposta.json();

        const form = document.getElementById('form-inscricao');
        form.innerHTML = ''; // Limpa mensagem carregando

        if (campos.length === 0) {
          form.innerHTML = '<p>Nenhum campo de formulário encontrado para este vestibular.</p>';
          return;
        }

        // Cria campos dinamicamente
        campos.forEach(campo => {
          const campoElemento = criarCampo(campo);
          form.appendChild(campoElemento);
        });

        // Botão de submit
        const btn = document.createElement('button');
        btn.type = 'submit';
        btn.textContent = 'Enviar Inscrição';
        form.appendChild(btn);

        // Aqui você pode colocar o handler do submit, se quiser salvar a inscrição

      } catch (error) {
        console.error('Erro ao carregar campos do formulário:', error);
        document.getElementById('form-inscricao').innerHTML = '<p>Erro ao carregar campos do formulário.</p>';
      }
    }

    carregarCamposFormulario();
  </script>
</body>
</html>
