<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Sistema do Candidato</title>
  <style>
    body { display: flex; font-family: Arial, sans-serif; margin: 0; }
    .left { width: 60%; padding: 20px; }
    .right { width: 40%; padding: 20px; background: #f0f0f0; }
    .form-box { margin-bottom: 20px; }
    .hidden { display: none; }
    .nav { margin-bottom: 20px; }
    .btn { margin-right: 10px; padding: 8px 16px; background: #007bff; color: white; border: none; cursor: pointer; }
  </style>
</head>
<body>

<div class="left">
  <div class="nav">
    <button class="btn" onclick="mostrar('cadastro')">Cadastro</button>
    <button class="btn" onclick="mostrar('login')">Login</button>
    <button class="btn" onclick="mostrar('inicio')">Início</button>
    <button class="btn" onclick="mostrar('inscricao')">Fazer Inscrição</button>
  </div>

  <div id="cadastro" class="form-box hidden">
    <h2>Cadastro do Candidato</h2>
    <input id="nome" placeholder="Nome" /><br />
    <input id="email" placeholder="Email" /><br />
    <input id="senha" placeholder="Senha" type="password" /><br />
    <button onclick="cadastrar()">Cadastrar</button>
  </div>

  <div id="login" class="form-box hidden">
    <h2>Login do Candidato</h2>
    <input id="loginEmail" placeholder="Email" /><br />
    <input id="loginSenha" placeholder="Senha" type="password" /><br />
    <button onclick="logar()">Entrar</button>
  </div>

  <div id="inicio" class="form-box">
    <h2>Bem-vindo!</h2>
    <p id="boasvindas">Use os botões acima para navegar.</p>
  </div>

  <div id="inscricao" class="form-box hidden">
    <h2>Fazer Inscrição</h2>
    <label for="selectVest">Escolha um Vestibular:</label><br />
    <select id="selectVest" onchange="carregarCamposInscricao()">
      <option>Carregando...</option>
    </select>
    <form id="formInscricao" onsubmit="enviarInscricao(event)"></form>
  </div>
</div>

<div class="right">
  <h3>Novidades</h3>
  <div id="novidades">Carregando novidades...</div>
</div>

<script>
  const API_KEY = 'SUA_API_KEY';
  const DB_URL = 'https://SEU_DATABASE_ID.restdb.io/rest';

  let candidatoLogado = null;

  function mostrar(secao) {
    document.querySelectorAll('.form-box').forEach(div => div.classList.add('hidden'));
    document.getElementById(secao).classList.remove('hidden');
    if (secao === 'inscricao') carregarVestibulares();
  }

  function cadastrar() {
    const nome = document.getElementById('nome').value;
    const email = document.getElementById('email').value;
    const senha = document.getElementById('senha').value;

    fetch(`${DB_URL}/candidatos`, {
      method: 'POST',
      headers: {
        'x-apikey': API_KEY,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ nome, email, senha })
    })
    .then(res => res.json())
    .then(() => {
      alert('Cadastro realizado!');
      mostrar('login');
    });
  }

  function logar() {
    const email = document.getElementById('loginEmail').value;
    const senha = document.getElementById('loginSenha').value;

    fetch(`${DB_URL}/candidatos?q={"email":"${email}","senha":"${senha}"}`, {
      headers: { 'x-apikey': API_KEY }
    })
    .then(res => res.json())
    .then(dados => {
      if (dados.length > 0) {
        candidatoLogado = dados[0];
        document.getElementById('boasvindas').innerText = `Olá, ${candidatoLogado.nome}!`;
        mostrar('inicio');
      } else {
        alert('Login inválido!');
      }
    });
  }

  function carregarNovidades() {
    fetch(`${DB_URL}/novidades`, {
      headers: { 'x-apikey': API_KEY }
    })
    .then(res => res.json())
    .then(dados => {
      if (dados.length > 0) {
        document.getElementById('novidades').innerText = dados[0].texto || 'Sem novidades.';
      } else {
        document.getElementById('novidades').innerText = 'Nenhuma novidade disponível.';
      }
    });
  }

  function carregarVestibulares() {
    fetch(`${DB_URL}/vestibulares?q={"status":"aberto"}`, {
      headers: { 'x-apikey': API_KEY }
    })
    .then(res => res.json())
    .then(lista => {
      const select = document.getElementById('selectVest');
      select.innerHTML = '<option value="">-- Selecione --</option>';
      lista.forEach(v => {
        const opt = document.createElement('option');
        opt.value = v._id;
        opt.innerText = v.titulo;
        select.appendChild(opt);
      });
    });
  }

  function carregarCamposInscricao() {
    const vestId = document.getElementById('selectVest').value;
    if (!vestId) return;

    fetch(`${DB_URL}/formcampos?q={"vestibular_id":"${vestId}"}`, {
      headers: { 'x-apikey': API_KEY }
    })
    .then(res => res.json())
    .then(campos => {
      const form = document.getElementById('formInscricao');
      form.innerHTML = '';
      campos.forEach(campo => {
        const label = document.createElement('label');
        label.innerText = campo.nome;
        const input = document.createElement('input');
        input.name = campo.nome;
        input.type = campo.tipo === 'email' ? 'email' : campo.tipo === 'number' ? 'number' : 'text';
        form.appendChild(label);
        form.appendChild(document.createElement('br'));
        form.appendChild(input);
        form.appendChild(document.createElement('br'));
      });
      const botao = document.createElement('button');
      botao.type = 'submit';
      botao.innerText = 'Enviar Inscrição';
      form.appendChild(botao);
    });
  }

  function enviarInscricao(event) {
    event.preventDefault();
    const vestId = document.getElementById('selectVest').value;
    const campos = {};
    const form = document.getElementById('formInscricao');
    Array.from(form.elements).forEach(el => {
      if (el.name) campos[el.name] = el.value;
    });

    fetch(`${DB_URL}/inscricoes`, {
      method: 'POST',
      headers: {
        'x-apikey': API_KEY,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        vestibular_id: vestId,
        candidato_id: candidatoLogado._id,
        campos
      })
    })
    .then(res => res.json())
    .then(() => {
      alert('Inscrição enviada com sucesso!');
      mostrar('inicio');
    });
  }

  window.onload = () => {
    carregarNovidades();
  };
</script>

</body>
</html>
